# å·¥ä½œæµåç§°ï¼šä¸ºJD BE6500 (IPQ5332)æ„å»ºOpenWrtå›ºä»¶
name: Build OpenWrt for JD BE6500 (IPQ5332)

# è§¦å‘æ¡ä»¶é…ç½®
on:
  # æ‰‹åŠ¨è§¦å‘å·¥ä½œæµï¼Œå¯é…ç½®è¾“å…¥å‚æ•°
  workflow_dispatch:  
    # è¾“å…¥å‚æ•°ï¼šæ˜¯å¦åŒ…å«WSDD2 (SMB3æ”¯æŒ)
    inputs:
      with_wsdd2:
        description: 'ç¼–è¯‘åŒ…å« WSDD2 (SMB3 æ”¯æŒ)'
        required: false
        default: 'true'
        type: boolean
      # è¾“å…¥å‚æ•°ï¼šæ˜¯å¦åŒ…å«Samba4
      with_samba4:
        description: 'ç¼–è¯‘åŒ…å« Samba4'
        required: false
        default: 'true'
        type: boolean
      # è¾“å…¥å‚æ•°ï¼šæ˜¯å¦åŒ…å«Dockeræ”¯æŒ
      with_docker:
        description: 'ç¼–è¯‘åŒ…å« Docker æ”¯æŒ'
        required: false
        default: 'true'
        type: boolean
  # å½“å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶è§¦å‘å·¥ä½œæµ
  release:
    types: published  

# å…¨å±€ç¯å¢ƒå˜é‡é…ç½®
env:
  # Lienolçš„OpenWrtä»“åº“åœ°å€
  #LIENOL_REPO: https://github.com/Lienol/openwrt          
  # ä½¿ç”¨çš„OpenWrtåˆ†æ”¯
  #LIENOL_BRANCH: 23.05   
  OPENWRT_REPO: https://git.openwrt.org/openwrt/openwrt.git          
  OPENWRT_BRANCH: openwrt-23.05.0  
  # ç›®æ ‡æ¶æ„
  ARCH: ipq5332                                          
  # å­æ¶æ„
  SUBARCH: generic                                       
  # CPUæ¶æ„
  CPU_ARCH: aarch64_cortex-a53                           
  # Feedsé…ç½®æ–‡ä»¶
  FEEDS_CONF: feeds.conf.default                         
  # ç¼–è¯‘é…ç½®æ–‡ä»¶
  CONFIG_FILE: .config                                   
  # è‡ªå®šä¹‰è„šæœ¬1
  DIY_P1_SH: diy-part1.sh                                
  # è‡ªå®šä¹‰è„šæœ¬2
  DIY_P2_SH: diy-part2.sh                                
  # æ˜¯å¦ä¸Šä¼ äºŒè¿›åˆ¶ç›®å½•
  UPLOAD_BIN_DIR: false                                  
  # æ˜¯å¦ä¸Šä¼ å›ºä»¶
  UPLOAD_FIRMWARE: true                                  
  # æ˜¯å¦å‘å¸ƒåˆ°Release
  UPLOAD_RELEASE: true                                   
  # æ˜¯å¦ä¸Šä¼ åˆ°CDN
  UPLOAD_CDN: false                                      
  # æ—¶åŒºè®¾ç½®
  TZ: Asia/Shanghai                                      
  # GitHubè®¤è¯ä»¤ç‰Œï¼ˆä»ä»“åº“ç§˜å¯†è·å–ï¼‰
  GITHUB_TOKEN: ${{ secrets.MY_TOKEN }}                  
  # ç¼“å­˜ç›®å½•
  CACHE_DIR: ${{ github.workspace }}/openwrt       

# ä½œä¸šå®šä¹‰
jobs:
  # ç¼–è¯‘ä½œä¸š
  build:
    # è¿è¡Œç¯å¢ƒï¼šUbuntu 22.04
    runs-on: ubuntu-22.04                                 

    steps:
    - name: æ£€æŸ¥ç¯å¢ƒ
      run: |
        # æ˜¾ç¤ºç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ
        df -hT
        # æ˜¾ç¤ºå†…å­˜ä½¿ç”¨æƒ…å†µ
        free -h
        # æ˜¾ç¤ºCPUä¿¡æ¯
        cat /proc/cpuinfo
        # æ˜¾ç¤ºæ“ä½œç³»ç»Ÿä¿¡æ¯
        cat /etc/os-release

    - name: å®‰è£…OpenWrtç¼–è¯‘ä¾èµ–
      run: |
        # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
        sudo apt-get update
        # å®‰è£…ç¼–è¯‘æ‰€éœ€çš„ç³»ç»ŸåŒ…
        sudo apt-get install -y build-essential ccache ecj fastjar file g++ gawk \
          gettext git java-propose-classpath libelf-dev libncurses5-dev \
          libncursesw5-dev libssl-dev python3 python3-distutils python3-setuptools \
          python3-dev rsync subversion swig time unzip wget xmlto zlib1g-dev \
          quilt autopoint libtool-bin gperf flex bison gettext-base asciidoc dos2unix \
          python3-pyelftools python3-pip
        # å®‰è£…Pythonä¾èµ–åŒ…
        pip install pyelftools

    - name: é…ç½®Gitå‡­è¯
      run: |
        # é…ç½®Gitå‡­è¯åŠ©æ‰‹
        git config --global credential.helper store
        # å†™å…¥Gitå‡­è¯ï¼ˆä½¿ç”¨GITHUB_TOKENï¼‰
        echo "https://${GITHUB_TOKEN}:@github.com" > ~/.git-credentials
        # è¾“å‡ºé…ç½®å®Œæˆä¿¡æ¯
        echo "Gitå‡­è¯å·²é…ç½®"
    - name: æ¸…ç†å·¥ä½œç›®å½•
      run: |
        # åˆ é™¤ç°æœ‰openwrtç›®å½•
        rm -rf openwrt
        # åˆ›å»ºæ–°çš„openwrtç›®å½•
        mkdir -p openwrt
    - name: å…‹éš†openwrtä»“åº“ï¼ˆå¸¦é‡è¯•æœºåˆ¶ï¼‰
      run: |
        # æ¸…ç†æ—§ä»“åº“ç›®å½•
        rm -rf openwrt
        # å¾ªç¯å°è¯•å…‹éš†ä»“åº“ï¼ˆæœ€å¤š5æ¬¡ï¼‰
        for i in {1..5}; do
          # è¾“å‡ºå½“å‰å°è¯•æ¬¡æ•°
          echo "=== ç¬¬ $i æ¬¡å…‹éš†å°è¯• ==="
          # å…‹éš†ä»“åº“ï¼ˆæ·±åº¦1ï¼ŒæŒ‡å®šåˆ†æ”¯ï¼‰
          #git clone --depth=1 $LIENOL_REPO -b $LIENOL_BRANCH openwrt
          git clone --depth=1 $OPENWRT_REPO -b $OPENWRT_BRANCH openwrt
          # æ£€æŸ¥å…‹éš†æ˜¯å¦æˆåŠŸ
          if [ $? -eq 0 ]; then
            echo "âœ… ä»“åº“å…‹éš†æˆåŠŸ"
            break
          fi
          # å…‹éš†å¤±è´¥æ—¶çš„æç¤ºå’Œç­‰å¾…
          echo "âŒ å…‹éš†å¤±è´¥ï¼Œ15ç§’åé‡è¯•..."
          sleep 15
        done
        # æ£€æŸ¥æ˜¯å¦æˆåŠŸå…‹éš†
        if [ ! -d "openwrt" ]; then
          echo "ğŸ’¥ äº”æ¬¡å…‹éš†å¤±è´¥ï¼Œé€€å‡º"
          exit 1
        fi
        # è¿›å…¥openwrtç›®å½•
        cd openwrt
        # è®¾ç½®OPENWRT_PATHç¯å¢ƒå˜é‡
        echo "OPENWRT_PATH=$(pwd)" >> $GITHUB_ENV
        # æ˜¾ç¤ºæœ€æ–°æäº¤ä¿¡æ¯
        git log -1
         # ç¡®ä¿å…‹éš†åˆ°æ­£ç¡®ç›®å½•
        if [ ! -d ".git" ]; then
         echo "âŒ å…‹éš†ç›®å½•ä¸æ­£ç¡®ï¼Œé€€å‡º"
         exit 1
         fi

    - name: ç¼“å­˜ä¾èµ–åŒ…ï¼ˆåŠ é€Ÿç¼–è¯‘ï¼‰
      uses: actions/cache@v3
      with:
        # ç¼“å­˜è·¯å¾„
        path: ${{ env.CACHE_DIR }}
        # ç¼“å­˜é”®ï¼ˆåŸºäºé…ç½®æ–‡ä»¶å’Œç›®æ ‡æ¶æ„ï¼‰
        key: ${{ runner.os }}-openwrt-dl-${{ hashFiles('feeds.conf.default', '.config', 'target/linux/ipq5332/**') }}
        # ç¼“å­˜æ¢å¤é”®
        restore-keys: |
          ${{ runner.os }}-openwrt-dl-

    - name: ä¾èµ–å¼ºåŒ–å®‰è£…ï¼ˆå®˜æ–¹æºä¼˜å…ˆï¼Œdebugçº§è¾“å‡ºï¼‰
      run: |
        # è¿›å…¥OpenWrtç›®å½•
        cd $OPENWRT_PATH
        # æ¸…ç†æ—§Feeds
        rm -rf feeds/*  
        
        # å¤šè½®æ›´æ–°Feedsï¼ˆåº”å¯¹ç½‘ç»œæ³¢åŠ¨ï¼‰
        for i in {1..3}; do
          # è¾“å‡ºå½“å‰æ›´æ–°æ¬¡æ•°
          echo "=== ç¬¬ $i æ¬¡Feedsæ›´æ–° ==="
          # æ¸…ç†æ—§Feeds
          rm -rf feeds/*
          # æ›´æ–°Feedså¹¶è®°å½•æ—¥å¿—
          ./scripts/feeds update  2>&1 | tee feeds_update_${i}.log
          # æ£€æŸ¥æ›´æ–°æ˜¯å¦æˆåŠŸ
          if [ $? -eq 0 ]; then
            break
          fi
          # å¤±è´¥æ—¶çš„æç¤ºå’Œç­‰å¾…
          echo "æ›´æ–°å¤±è´¥ï¼Œ10ç§’åé‡è¯•..."
          sleep 10
        done
        
        # æŒ‰ä¼˜å…ˆçº§å®‰è£…Feedsï¼ˆå®˜æ–¹æºä¼˜å…ˆï¼‰
        ./scripts/feeds install -p base -p packages -p luci -p wireless -p qca -p routing -p telephony
        ./scripts/feeds install -p packages 
        ./scripts/feeds install  -p luci 
        ./scripts/feeds install  -p routing 
        ./scripts/feeds install  -p telephony 
        ./scripts/feeds install  -p wireless 
        ./scripts/feeds install  -p qca 
        # ä¼˜å…ˆå®‰è£…QCAé©±åŠ¨
        #./scripts/feeds install -p qca kmod-ath11k-ct kmod-ath11k-firmware-qca64 kmod-qca-nss-drv kmod-qca-nss-gmac kmod-qca-ppe kmod-thermal-qcom
        ./scripts/feeds install -p wireless kmod-ath11k-ct kmod-ath11k-firmware-qca64
        ./scripts/feeds install -p qca kmod-qca-nss-drv kmod-qca-nss-gmac kmod-qca-ppe kmod-thermal-qcom

        # æ˜ç¡®ä»wirelessæºå®‰è£…Wi-Fié©±åŠ¨
        ./scripts/feeds install -p wireless kmod-ath11k-ct kmod-ath11k-firmware-qca64
    
        # ä»qcaæºå®‰è£…ç½‘ç»œé©±åŠ¨
        ./scripts/feeds install -p qca kmod-qca-nss-drv kmod-qca-nss-gmac kmod-qca-ppe kmod-thermal-qcom
    
        # å®‰è£…ç¼ºå¤±çš„åŸºç¡€ä¾èµ–
        ./scripts/feeds install -p packages libpam luci-base liblzma libnetsnmp
   
        # å®‰è£…Sambaç›¸å…³ä¾èµ–
        ./scripts/feeds install -p luci luci-app-samba luci-app-samba4 wsdd
        
        # é©±åŠ¨å­˜åœ¨æ€§éªŒè¯
        if ! ls feeds | grep -q "kmod-ath11k-ct"; then
          echo "âŒ å…³é”®é©±åŠ¨kmod-ath11k-ctæœªå®‰è£…ï¼Œé€€å‡º"
          exit 1
        fi
        if ! ls feeds | grep -q "kmod-qca-nss-drv"; then
          echo "âŒ å…³é”®é©±åŠ¨kmod-qca-nss-drvæœªå®‰è£…ï¼Œé€€å‡º"
          exit 1
        fi
        
        # å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶åŒ…
        ./scripts/feeds install -a -p kenzo 
        ./scripts/feeds install -a -p small 
        
        # å¤‡ç”¨é©±åŠ¨å®‰è£…é€»è¾‘ï¼ˆè‹¥Feedsä¸­æœªæ‰¾åˆ°ï¼‰
        if ! ./scripts/feeds list | grep -q "kmod-ath11k-ct"; then
          echo "âš ï¸ æœªæ‰¾åˆ°ath11ké©±åŠ¨ï¼Œå¼ºåˆ¶ä»wirelessæºå®‰è£…..."
          ./scripts/feeds install -f -p wireless kmod-ath11k-ct 
          
          # å†æ¬¡æ£€æŸ¥é©±åŠ¨
          if ! ./scripts/feeds list | grep -q "kmod-ath11k-ct"; then
            echo "âŒ ä»æœªæ‰¾åˆ°é©±åŠ¨ï¼Œæ‰‹åŠ¨æ„å»ºath11k-ct Makefile..."
            # åˆ›å»ºæ‰‹åŠ¨é©±åŠ¨åŒ…ç›®å½•
            mkdir -p package/kernel/ath11k-ct
            
            # é€è¡Œç”ŸæˆMakefileå†…å®¹
            echo 'include $(TOPDIR)/rules.mk' > package/kernel/ath11k-ct/Makefile
            echo 'include $(INCLUDE_DIR)/kernel.mk' >> package/kernel/ath11k-ct/Makefile
            echo '' >> package/kernel/ath11k-ct/Makefile
            echo 'PKG_NAME:=ath11k-ct' >> package/kernel/ath11k-ct/Makefile
            echo 'PKG_VERSION:=2023.05' >> package/kernel/ath11k-ct/Makefile
            echo 'PKG_RELEASE:=1' >> package/kernel/ath11k-ct/Makefile
            echo '' >> package/kernel/ath11k-ct/Makefile
            echo 'PKG_SOURCE_URL:=https://git.openwrt.org/project/libs/ath11k-ct.git' >> package/kernel/ath11k-ct/Makefile
            echo 'PKG_SOURCE_PROTO:=git' >> package/kernel/ath11k-ct/Makefile
            echo 'PKG_SOURCE_VERSION:=openwrt-23.05' >> package/kernel/ath11k-ct/Makefile
            echo 'PKG_MIRROR_HASH:=skip' >> package/kernel/ath11k-ct/Makefile
            echo '' >> package/kernel/ath11k-ct/Makefile
            echo 'PKG_MAINTAINER:=John Doe <john@example.com>' >> package/kernel/ath11k-ct/Makefile
            echo 'PKG_LICENSE:=GPL-2.0-only' >> package/kernel/ath11k-ct/Makefile
            echo 'PKG_LICENSE_FILES:=LICENSE' >> package/kernel/ath11k-ct/Makefile
            echo '' >> package/kernel/ath11k-ct/Makefile
            echo 'include $(INCLUDE_DIR)/package.mk' >> package/kernel/ath11k-ct/Makefile
            echo '' >> package/kernel/ath11k-ct/Makefile
            echo 'define KernelPackage/ath11k-ct' >> package/kernel/ath11k-ct/Makefile
            echo '  SUBMENU:=Wireless Drivers' >> package/kernel/ath11k-ct/Makefile
            echo '  TITLE:=Atheros ath11k wireless driver (CT version)' >> package/kernel/ath11k-ct/Makefile
            echo '  DEPENDS:=+kmod-cfg80211 +kmod-usb-core +kmod-mac80211' >> package/kernel/ath11k-ct/Makefile
            echo '  KCONFIG:= \' >> package/kernel/ath11k-ct/Makefile
            echo '    CONFIG_ATH11K=m \' >> package/kernel/ath11k-ct/Makefile
            echo '    CONFIG_ATH11K_DEBUGFS=n \' >> package/kernel/ath11k-ct/Makefile
            echo '    CONFIG_ATH11K_TRACE=n' >> package/kernel/ath11k-ct/Makefile
            echo '  FILES:=$(PKG_BUILD_DIR)/compat.ko $(PKG_BUILD_DIR)/ath11k.ko' >> package/kernel/ath11k-ct/Makefile
            echo '  AUTOLOAD:=$(call AutoProbe,ath11k)' >> package/kernel/ath11k-ct/Makefile
            echo 'endef' >> package/kernel/ath11k-ct/Makefile
            echo '' >> package/kernel/ath11k-ct/Makefile
            echo 'define KernelPackage/ath11k-ct/description' >> package/kernel/ath11k-ct/Makefile
            echo '  This package contains the Atheros ath11k wireless driver' >> package/kernel/ath11k-ct/Makefile
            echo '  for newer Qualcomm Atheros chipsets.' >> package/kernel/ath11k-ct/Makefile
            echo 'endef' >> package/kernel/ath11k-ct/Makefile
            echo '' >> package/kernel/ath11k-ct/Makefile
            echo '$(eval $(call KernelPackage,ath11k-ct))' >> package/kernel/ath11k-ct/Makefile
            
            echo "âœ… æ‰‹åŠ¨æ„å»ºath11k-ct Makefileå®Œæˆ"
          else
            echo "âœ… ä»wirelessæºå¼ºåˆ¶å®‰è£…ath11ké©±åŠ¨æˆåŠŸ"
          fi
        else
          echo "âœ… IPQ5332 Wi-Fié©±åŠ¨å·²é€šè¿‡Feedså®‰è£…"
        fi

    - name: åŸºç¡€é…ç½®ç”Ÿæˆï¼ˆå¼ºåˆ¶ç›®æ ‡å¹³å°ï¼‰
      run: |
        # è¿›å…¥OpenWrtç›®å½•
        cd $OPENWRT_PATH
        # æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç°æœ‰é…ç½®æ–‡ä»¶
        if [ -f "$CONFIG_FILE" ]; then
          echo "âœ… å‘ç°å·²æœ‰.configï¼Œæ›´æ–°ç›®æ ‡å¹³å°é…ç½®"
          # å¤‡ä»½ç°æœ‰é…ç½®
          cp $CONFIG_FILE ${CONFIG_FILE}.bak
          # ç§»é™¤æ—§çš„ç›®æ ‡å¹³å°é…ç½®
          sed -i '/CONFIG_TARGET_IPQ807X/d' $CONFIG_FILE
          sed -i '/CONFIG_TARGET_IPQ807X_DEVICE_jd-be6500/d' $CONFIG_FILE
        else
          echo "âŒ æœªå‘ç°.configï¼Œç”Ÿæˆé»˜è®¤é…ç½®"
          # ç”Ÿæˆé»˜è®¤é…ç½®
          make defconfig
        fi
        
        # å¼ºåˆ¶å†™å…¥ç›®æ ‡å¹³å°é…ç½®
        echo "CONFIG_TARGET_IPQ807X=y" >> $CONFIG_FILE
        echo "CONFIG_TARGET_IPQ807X_DEVICE_jd-be6500=y" >> $CONFIG_FILE
        echo "CONFIG_TARGET_DEVICE_PACKAGES_jd-be6500=\"kmod-ath11k-ct kmod-qca-ppe kmod-qca-nss-drv kmod-qca-nss-gmac kmod-thermal-qcom\"" >> $CONFIG_FILE
        echo "CONFIG_TARGET_KERNEL_PARTSIZE=32" >> $CONFIG_FILE
        echo "CONFIG_TARGET_ROOTFS_PARTSIZE=256" >> $CONFIG_FILE
        
        # æ˜¾ç¤ºå½“å‰è®¾å¤‡é…ç½®
        echo "=== å½“å‰.config è®¾å¤‡é…ç½® ==="
        grep -E "CONFIG_TARGET_IPQ807X_DEVICE|CONFIG_TARGET_DEVICE_PACKAGES" .config

    - name: è®¾å¤‡æ ‘å¼ºåˆ¶å…³è”ï¼ˆçº¯echoå®ç°ï¼‰
      run: |
        # è¿›å…¥OpenWrtç›®å½•
        cd $OPENWRT_PATH
        # å®šä¹‰è®¾å¤‡æ ‘ç›®å½•
        DTS_DIR="target/linux/$ARCH/dts"
        # åˆ›å»ºç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
        mkdir -p "$DTS_DIR"
        # å®šä¹‰è®¾å¤‡æ ‘æ–‡ä»¶è·¯å¾„
        DEVICE_TREE="$DTS_DIR/qcom,ipq5332-jd-be6500.dts"
        
        # ç”Ÿæˆè®¾å¤‡æ ‘æ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
        if [ ! -f "$DEVICE_TREE" ]; then
          # é€è¡Œå†™å…¥è®¾å¤‡æ ‘å†…å®¹
          echo "/dts-v1/;" > "$DEVICE_TREE"
          echo "#include \"qcom,ipq5332.dtsi\"" >> "$DEVICE_TREE"
          echo "#include \"ipq807x.dtsi\"" >> "$DEVICE_TREE"
          echo "" >> "$DEVICE_TREE"
          echo "/ {" >> "$DEVICE_TREE"
          echo "    model = \"JD BE6500\";" >> "$DEVICE_TREE"
          echo "    compatible = \"qcom,ipq5332\", \"qcom,ipq5000\", \"qcom,ipq807x\";" >> "$DEVICE_TREE"
          echo "    /* Ethernet ports */" >> "$DEVICE_TREE"
          echo "    ethernet@a4000000 {" >> "$DEVICE_TREE"
          echo "        compatible = \"qcom,ipq5332-gmac\";" >> "$DEVICE_TREE"
          echo "        reg = <0xa4000000 0x10000>;" >> "$DEVICE_TREE"
          echo "        interrupts = <0 36 4>;" >> "$DEVICE_TREE"
          echo "        qcom,mdio-bus = <&mdio>;" >> "$DEVICE_TREE"
          echo "        qcom,phy-handle = <&ethphy0>;" >> "$DEVICE_TREE"
          echo "    };" >> "$DEVICE_TREE"
          echo "    mdio@a4002000 {" >> "$DEVICE_TREE"
          echo "        compatible = \"qcom,ipq5332-mdio\";" >> "$DEVICE_TREE"
          echo "        reg = <0xa4002000 0x1000>;" >> "$DEVICE_TREE"
          echo "        #address-cells = <1>;" >> "$DEVICE_TREE"
          echo "        #size-cells = <0>;" >> "$DEVICE_TREE"
          echo "        ethphy0: ethernet-phy@0 {" >> "$DEVICE_TREE"
          echo "            reg = <0>;" >> "$DEVICE_TREE"
          echo "        };" >> "$DEVICE_TREE"
          echo "    };" >> "$DEVICE_TREE"
          echo "    /* æ­¤å¤„å¯æ‰©å±•å®Œæ•´è®¾å¤‡æ ‘å†…å®¹ */" >> "$DEVICE_TREE"
          echo "};" >> "$DEVICE_TREE"
          echo "âœ… ç”Ÿæˆè®¾å¤‡æ ‘: $DEVICE_TREE"
        else
          echo "âœ… è®¾å¤‡æ ‘å·²å­˜åœ¨: $DEVICE_TREE"
        fi
        
        # å…³è”è®¾å¤‡æ ‘åˆ°Makefile
        MAKEFILE="target/linux/$ARCH/image/Makefile"
        # æ£€æŸ¥Makefileä¸­æ˜¯å¦å·²å…³è”è®¾å¤‡æ ‘
        if ! grep -q "jd-be6500" "$MAKEFILE"; then
          echo "âŒ è®¾å¤‡æ ‘æœªå…³è”ï¼Œæ‰‹åŠ¨æ·»åŠ å®šä¹‰..."
          # å¤‡ä»½åŸMakefile
          cp "$MAKEFILE" "${MAKEFILE}.bak"  
          
          # é€è¡Œæ·»åŠ è®¾å¤‡å®šä¹‰
          echo 'define Device/jd-be6500' >> "$MAKEFILE"
          echo '  $(Device/ipq807x)' >> "$MAKEFILE"
          echo '  DEVICE_TITLE := JD BE6500 (IPQ5332)' >> "$MAKEFILE"
          echo '  DEVICE_DTS := qcom,ipq5332-jd-be6500' >> "$MAKEFILE"
          echo '  DEVICE_PACKAGES := kmod-ath11k-ct kmod-qca-ppe kmod-qca-nss-drv kmod-qca-nss-gmac kmod-thermal-qcom' >> "$MAKEFILE"
          echo '  IMAGE_SIZE := 256m' >> "$MAKEFILE"
          echo '  IMAGES := sysupgrade.bin factory.bin' >> "$MAKEFILE"
          echo '  IMAGE/sysupgrade.bin := append-kernel | append-rootfs | pad-to \$$(IMAGE_SIZE) | check-size \$$(IMAGE_SIZE)' >> "$MAKEFILE"
          echo '  IMAGE/factory.bin := append-kernel | append-rootfs | pad-to \$$(IMAGE_SIZE) | check-size \$$(IMAGE_SIZE)' >> "$MAKEFILE"
          echo 'endef' >> "$MAKEFILE"
          echo 'TARGET_DEVICES += jd-be6500' >> "$MAKEFILE"
          
          # éªŒè¯è®¾å¤‡å®šä¹‰æ˜¯å¦æ·»åŠ æˆåŠŸ
          if grep -q "jd-be6500" "$MAKEFILE"; then
            echo "âœ… è®¾å¤‡æ ‘å·²å…³è”åˆ°Makefile"
          else
            echo "âŒ è®¾å¤‡æ ‘å…³è”å¤±è´¥ï¼Œé€€å‡ºæ„å»º"
            exit 1
          fi
        else
          echo "âœ… è®¾å¤‡æ ‘å·²å…³è”åˆ°Makefile"
        fi

    - name: åº”ç”¨è‡ªå®šä¹‰è„šæœ¬ï¼ˆå®¹é”™å¤„ç†ï¼‰
      run: |
        # è¿›å…¥OpenWrtç›®å½•
        cd $OPENWRT_PATH
        # å¾ªç¯å¤„ç†è‡ªå®šä¹‰è„šæœ¬
        for SCRIPT in $DIY_P1_SH $DIY_P2_SH; do
          # æ£€æŸ¥è„šæœ¬æ˜¯å¦å­˜åœ¨
          if [ -f "$SCRIPT" ]; then
            echo "æ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬: $SCRIPT"
            # æ·»åŠ æ‰§è¡Œæƒé™
            chmod +x "$SCRIPT"
            # æ‰§è¡Œè„šæœ¬å¹¶å¿½ç•¥é”™è¯¯ï¼ˆç»§ç»­æ„å»ºï¼‰
            ./$SCRIPT || echo "âš ï¸ è‡ªå®šä¹‰è„šæœ¬ $SCRIPT æ‰§è¡Œå¤±è´¥ï¼Œç»§ç»­æ„å»º"
          else
            echo "âŒ æœªæ‰¾åˆ°è‡ªå®šä¹‰è„šæœ¬: $SCRIPT"
          fi
        done

    - name: ä¸‹è½½ä¾èµ–åŒ…ï¼ˆç¼“å­˜+æ ¡éªŒï¼‰
      run: |
        # è¿›å…¥OpenWrtç›®å½•
        cd $OPENWRT_PATH
        # æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç¼“å­˜ä¾èµ–åŒ…
        if [ -d "${{ env.CACHE_DIR }}/dl" ]; then
          echo "ä½¿ç”¨ç¼“å­˜ä¾èµ–åŒ…..."
          # å¤åˆ¶ç¼“å­˜ä¾èµ–åŒ…åˆ°å½“å‰ç›®å½•
          cp -rf "${{ env.CACHE_DIR }}/dl" .
        fi
        
        # ä¸‹è½½ä¾èµ–åŒ…ï¼ˆå¹¶è¡Œå¤„ç†ï¼‰
        make download -j$(nproc) V=s
        # ä¿å­˜ä¸‹è½½çŠ¶æ€
        DOWNLOAD_STATUS=$?
        
        # åˆ›å»ºç¼“å­˜ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
        mkdir -p "${{ env.CACHE_DIR }}/dl"
        # å¤åˆ¶ä¸‹è½½çš„ä¾èµ–åŒ…åˆ°ç¼“å­˜ç›®å½•
        cp -rf dl/* "${{ env.CACHE_DIR }}/dl/"
        # æ¸…ç†ç©ºæ–‡ä»¶
        find dl -size -1024c -exec rm -f {} \; 
        
        # æ£€æŸ¥ä¸‹è½½çŠ¶æ€å¹¶è¾“å‡ºä¿¡æ¯
        if [ $DOWNLOAD_STATUS -ne 0 ]; then
          echo "âš ï¸ ä¾èµ–ä¸‹è½½å¼‚å¸¸ï¼Œç»§ç»­æ„å»ºï¼ˆå¯èƒ½å½±å“ç»“æœï¼‰"
          find dl -type f -empty -exec echo "ç©ºæ–‡ä»¶: {}" \;
        else
          echo "âœ… ä¾èµ–ä¸‹è½½å®Œæˆï¼ˆå…± $(find dl -type f | wc -l) ä¸ªæ–‡ä»¶ï¼‰"
        fi

    - name: ç¼–è¯‘å›ºä»¶ï¼ˆåŒé˜¶æ®µ+è¯¦ç»†æ—¥å¿—ï¼‰
      run: |
        # è¿›å…¥OpenWrtç›®å½•
        cd $OPENWRT_PATH
        # è·å–ç³»ç»Ÿæ ¸å¿ƒæ•°
        JOBS=$(nproc)
        # é™åˆ¶çº¿ç¨‹æ•°ï¼ˆæœ€å¤š4ä¸ªï¼‰
        [ $JOBS -gt 4 ] && JOBS=4 
        
        # é˜¶æ®µ1ï¼šå¹¶è¡Œç¼–è¯‘
        echo "å¼€å§‹å¹¶è¡Œç¼–è¯‘ï¼ˆ-j$JOBSï¼‰..."
        # å¹¶è¡Œç¼–è¯‘å¹¶è®°å½•æ—¥å¿—
        make -j$JOBS V=s 2>&1 | tee compile_phase1.log
        # ä¿å­˜é˜¶æ®µ1çŠ¶æ€
        PHASE1_STATUS=$?
        
        # é˜¶æ®µ1å¤±è´¥æ—¶å°è¯•å•çº¿ç¨‹ç¼–è¯‘
        if [ $PHASE1_STATUS -ne 0 ]; then
          echo "âŒ å¹¶è¡Œç¼–è¯‘å¤±è´¥ï¼Œåˆ‡æ¢å•çº¿ç¨‹é‡è¯•..."
          # å•çº¿ç¨‹ç¼–è¯‘å¹¶è®°å½•æ—¥å¿—
          make -j1 V=s 2>&1 | tee compile_phase2.log
          PHASE2_STATUS=$?
          
          # é˜¶æ®µ2å¤±è´¥æ—¶æ”¶é›†é”™è¯¯æ—¥å¿—
          if [ $PHASE2_STATUS -ne 0 ]; then
            echo "ğŸ’¥ ç¼–è¯‘å¤±è´¥ï¼Œæ”¶é›†é”™è¯¯æ—¥å¿—..."
            # åˆ›å»ºé”™è¯¯æ—¥å¿—ç›®å½•
            mkdir -p error_logs
            # å¤åˆ¶ç¼–è¯‘æ—¥å¿—åˆ°é”™è¯¯ç›®å½•
            cp compile_phase*.log error_logs/
            # å¤åˆ¶å…¶ä»–é”™è¯¯æ–‡ä»¶
            cp $(find . -name "*.err" -or -name "*.log" -or -name "*.rej") error_logs/ 2>/dev/null
            # å¤åˆ¶é…ç½®æ–‡ä»¶å’ŒMakefile
            cp .config error_logs/
            cp target/linux/ipq807x/image/Makefile error_logs/
            # å‹ç¼©é”™è¯¯æ—¥å¿—
            tar -czf error_logs.tar.gz error_logs
            exit 1
          else
            echo "âœ… å•çº¿ç¨‹ç¼–è¯‘æˆåŠŸ"
          fi
        else
          echo "âœ… å¹¶è¡Œç¼–è¯‘æˆåŠŸ"
        fi

    - name: å…³é”®ä¿®å¤ï¼šå¼ºåˆ¶è®¾ç½®è®¾å¤‡å®šä¹‰
      run: |
        # è¿›å…¥OpenWrtç›®å½•
        cd $OPENWRT_PATH
        # å®šä¹‰Makefileè·¯å¾„
        MAKEFILE="target/linux/$ARCH/image/Makefile"
        
        # æ£€æŸ¥è®¾å¤‡å®šä¹‰æ˜¯å¦å­˜åœ¨
        if ! grep -q "define Device/jd-be6500" "$MAKEFILE"; then
          echo "âŒ æœªæ‰¾åˆ°è®¾å¤‡å®šä¹‰ï¼Œæ·»åŠ æ­£ç¡®é…ç½®..."
          # å¤‡ä»½åŸMakefile
          cp "$MAKEFILE" "${MAKEFILE}.bak"
          
          # æ·»åŠ è®¾å¤‡å®šä¹‰
          echo 'define Device/jd-be6500' >> "$MAKEFILE"
          echo '  $(Device/ipq807x)' >> "$MAKEFILE"
          echo '  DEVICE_TITLE := JD BE6500 (IPQ5332)' >> "$MAKEFILE"
          echo '  DEVICE_DTS := qcom,ipq5332-jd-be6500' >> "$MAKEFILE"
          echo '  DEVICE_PACKAGES := kmod-ath11k-ct kmod-qca-ppe kmod-qca-nss-drv kmod-qca-nss-gmac kmod-thermal-qcom' >> "$MAKEFILE"
          echo '  IMAGE_SIZE := 256m' >> "$MAKEFILE"
          echo '  IMAGES := sysupgrade.bin factory.bin' >> "$MAKEFILE"
          echo '  IMAGE/sysupgrade.bin := append-kernel | append-rootfs | pad-to \$$(IMAGE_SIZE) | check-size \$$(IMAGE_SIZE)' >> "$MAKEFILE"
          echo '  IMAGE/factory.bin := append-kernel | append-rootfs | pad-to \$$(IMAGE_SIZE) | check-size \$$(IMAGE_SIZE)' >> "$MAKEFILE"
          echo 'endef' >> "$MAKEFILE"
          echo 'TARGET_DEVICES += jd-be6500' >> "$MAKEFILE"
          
          echo "âœ… è®¾å¤‡å®šä¹‰å·²æ›´æ–°"
        else
          # ä¿®å¤å¯èƒ½çš„é‡å¤genericå®šä¹‰
          echo "ä¿®å¤è®¾å¤‡å®šä¹‰ä¸­çš„é‡å¤generic..."
          # æ·»åŠ è®¾å¤‡åç§°
          sed -i '/define Device\/jd-be6500/a \  DEVICE_NAME := jd-be6500' "$MAKEFILE"
          # æ·»åŠ è®¾å¤‡é…ç½®æ–‡ä»¶
          sed -i '/define Device\/jd-be6500/a \  DEVICE_PROFILE := jd-be6500' "$MAKEFILE"
          # æ·»åŠ æ–‡ä»¶ç³»ç»Ÿç±»å‹
          sed -i '/define Device\/jd-be6500/a \  DEVICE_FILESYSTEMS := squashfs ext4' "$MAKEFILE"
          
          # ç¡®ä¿DEVICE_PACKAGESæ­£ç¡®
          sed -i 's/^ \+DEVICE_PACKAGES.*/  DEVICE_PACKAGES := kmod-ath11k-ct kmod-qca-ppe kmod-qca-nss-drv kmod-qca-nss-gmac kmod-thermal-qcom/' "$MAKEFILE"
          
          echo "âœ… è®¾å¤‡å®šä¹‰å·²ä¼˜åŒ–"
        fi

    - name: æ¸…ç†.configä¸­çš„å†—ä½™è®¾ç½®
      run: |
        # è¿›å…¥OpenWrtç›®å½•
        cd $OPENWRT_PATH
        # å®šä¹‰é…ç½®æ–‡ä»¶è·¯å¾„
        CONFIG_FILE=".config"
        
        # å¤‡ä»½åŸé…ç½®
        cp "$CONFIG_FILE" "${CONFIG_FILE}.bak"
        
        # ç§»é™¤é‡å¤çš„TARGET_GENERICè®¾ç½®
        sed -i '/CONFIG_TARGET_GENERIC/d' "$CONFIG_FILE"
        
        # ç¡®ä¿æ­£ç¡®çš„è®¾å¤‡è®¾ç½®
        sed -i '/CONFIG_TARGET_IPQ807X/d' "$CONFIG_FILE"
        sed -i '/CONFIG_TARGET_IPQ807X_DEVICE_jd-be6500/d' "$CONFIG_FILE"
        
        # é‡æ–°å†™å…¥æ­£ç¡®çš„è®¾å¤‡é…ç½®
        echo "CONFIG_TARGET_IPQ807X=y" >> "$CONFIG_FILE"
        echo "CONFIG_TARGET_IPQ807X_DEVICE_jd-be6500=y" >> "$CONFIG_FILE"
        
        # ç§»é™¤å¯èƒ½å¯¼è‡´é‡å¤å‘½åçš„è®¾ç½®
        sed -i '/CONFIG_TARGET_IMAGES_PAD/d' "$CONFIG_FILE"
        sed -i '/CONFIG_TARGET_ROOTFS_PARTSIZE/d' "$CONFIG_FILE"
        
        # ç¡®ä¿å¿…è¦çš„ç¼–è¯‘é€‰é¡¹
        echo "CONFIG_ALL_KMODS=y" >> "$CONFIG_FILE"
        echo "CONFIG_DEVEL=y" >> "$CONFIG_FILE"
        
        echo "âœ… .configå·²ä¼˜åŒ–"

    - name: æ™ºèƒ½å›ºä»¶è·¯å¾„æ£€æµ‹ï¼ˆå¤šè·¯å¾„é€‚é…+æ¨¡ç³ŠåŒ¹é…ï¼‰
      id: firmware_path
      run: |
        # è¿›å…¥OpenWrtç›®å½•
        cd $OPENWRT_PATH
        
        # å®šä¹‰å¯èƒ½çš„å›ºä»¶è·¯å¾„ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰
        FIRMWARE_PATHS=(
          "bin/targets/ipq807x/generic"  # æ ‡å‡†å›ºä»¶è·¯å¾„
          "bin/targets/ipq807x/jd-be6500"  # ç‰¹å®šè®¾å¤‡è·¯å¾„
          "bin/targets/qcom/ipq5332"
          "bin"
        )
        
        # æŸ¥æ‰¾å­˜åœ¨çš„å›ºä»¶è·¯å¾„
        FOUND_PATH=""
        for path in "${FIRMWARE_PATHS[@]}"; do
          if [ -d "$path" ]; then
            FOUND_PATH="$path"
            echo "âœ… æ‰¾åˆ°å›ºä»¶ç›®å½•: $path"
            break
          fi
        done
        
        # éªŒè¯è·¯å¾„æ˜¯å¦æ‰¾åˆ°
        if [ -z "$FOUND_PATH" ]; then
          echo "âŒ æœªæ‰¾åˆ°ä»»ä½•å›ºä»¶ç›®å½•ï¼Œå¯ç”¨è·¯å¾„:"
          # æ˜¾ç¤ºå¯èƒ½çš„ç›®å½•ç»“æ„
          find . -type d -name "bin" -o -name "ipq807x" -o -name "qcom" -o -name "generic"
          exit 1
        fi
        
        # ä¿å­˜è·¯å¾„åˆ°ç¯å¢ƒå˜é‡
        echo "FIRMWARE_PATH=$FOUND_PATH" >> $GITHUB_ENV
        echo "firmware_path=$FOUND_PATH" >> $GITHUB_OUTPUT
        
        # å®šä¹‰å¯èƒ½çš„å›ºä»¶æ–‡ä»¶åæ¨¡å¼ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰
        echo "æ£€æŸ¥å›ºä»¶æ–‡ä»¶..."
        FIRMWARE_PATTERNS=(
          "jd-be6500-squashfs-sysupgrade.bin"  # ç²¾ç¡®åŒ¹é…
          "jd-be6500-factory.bin"
          "ipq5332-jd-be6500-squashfs-sysupgrade.bin"
          "ipq807x-jd-be6500-squashfs-sysupgrade.bin"
          "*squashfs-sysupgrade.bin"
          "*factory.bin"
        )
        
        # æŒ‰æ¨¡å¼æŸ¥æ‰¾å›ºä»¶æ–‡ä»¶
        FOUND=false
        for pattern in "${FIRMWARE_PATTERNS[@]}"; do
          # è·å–åŒ¹é…çš„æ–‡ä»¶åˆ—è¡¨
          MATCHING_FILES=($(ls $FOUND_PATH/$pattern 2>/dev/null))
          if [ ${#MATCHING_FILES[@]} -gt 0 ]; then
            # æå–å›ºä»¶åç§°å’Œå®Œæ•´è·¯å¾„
            FIRMWARE_NAME=${MATCHING_FILES[0]}
            FIRMWARE_FULL_PATH="$FOUND_PATH/${MATCHING_FILES[0]}"
            
            echo "âœ… æ‰¾åˆ°åŒ¹é…çš„å›ºä»¶æ–‡ä»¶: $FIRMWARE_NAME"
            echo "å›ºä»¶åç§°: $FIRMWARE_NAME"
            echo "å›ºä»¶è·¯å¾„: $FIRMWARE_FULL_PATH"
            
            # ä¿å­˜åˆ°ç¯å¢ƒå˜é‡
            echo "FIRMWARE_NAME=$FIRMWARE_NAME" >> $GITHUB_ENV
            echo "FIRMWARE_FULL_PATH=$FIRMWARE_FULL_PATH" >> $GITHUB_ENV
            echo "firmware_name=$FIRMWARE_NAME" >> $GITHUB_OUTPUT
            echo "firmware_full_path=$FIRMWARE_FULL_PATH" >> $GITHUB_OUTPUT
            
            FOUND=true
            break
          fi
        done
        
        # æ£€æŸ¥æ˜¯å¦æ‰¾åˆ°å›ºä»¶æ–‡ä»¶
        if [ "$FOUND" = false ]; then
          echo "âŒ æœªæ‰¾åˆ°ä»»ä½•åŒ¹é…çš„å›ºä»¶æ–‡ä»¶ï¼Œå¯ç”¨æ–‡ä»¶:"
          # æ˜¾ç¤ºå¯ç”¨çš„å›ºä»¶æ–‡ä»¶
          ls -lh $FOUND_PATH/*.bin || true
          exit 1
        fi

    - name: éªŒè¯å›ºä»¶å­˜åœ¨
      run: |
        # è¿›å…¥OpenWrtç›®å½•
        cd $OPENWRT_PATH
        
        # éªŒè¯å›ºä»¶æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        if [ -f "${{ env.FIRMWARE_FULL_PATH }}" ]; then
          echo "âœ… å›ºä»¶å­˜åœ¨: ${{ env.FIRMWARE_FULL_PATH }}"
          # æ˜¾ç¤ºå›ºä»¶å¤§å°
          echo "å›ºä»¶å¤§å°: $(du -h ${{ env.FIRMWARE_FULL_PATH }} | cut -f1)"
          # æ˜¾ç¤ºå›ºä»¶SHA256æ ¡éªŒå’Œ
          echo "å›ºä»¶SHA256æ ¡éªŒå’Œ: $(sha256sum ${{ env.FIRMWARE_FULL_PATH }} | cut -d' ' -f1)"
        else
          echo "âŒ å›ºä»¶ä¸å­˜åœ¨: ${{ env.FIRMWARE_FULL_PATH }}"
          # æ˜¾ç¤ºå¯ç”¨æ–‡ä»¶
          echo "å¯ç”¨æ–‡ä»¶:"
          ls -lh ${{ env.FIRMWARE_PATH }}/*.bin || true
          exit 1
        fi

    - name: æ˜¾ç¤ºç›®å½•ç»“æ„ï¼ˆè°ƒè¯•ç”¨ï¼‰
      run: |
        # è¿›å…¥OpenWrtç›®å½•
        cd $OPENWRT_PATH
        # æ˜¾ç¤ºå…³é”®ç›®å½•ç»“æ„
        echo "=== ç›®å½•ç»“æ„ ==="
        find . -type d -name "target" -o -name "bin" -o -name "ipq807x" -o -name "ipq5332" -o -name "qcom" -o -name "generic"
        
        # æ˜¾ç¤ºå›ºä»¶æ–‡ä»¶åˆ—è¡¨
        echo "=== å›ºä»¶æ–‡ä»¶åˆ—è¡¨ ==="
        find . -name "*.bin" -o -name "*.img" -o -name "*.tar.gz"

    - name: ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯
      id: version
      run: |
        # è¿›å…¥OpenWrtç›®å½•
        cd $OPENWRT_PATH
        # ç”Ÿæˆç‰ˆæœ¬æ—¥æœŸ
        RELEASE_DATE=$(date +%Y%m%d)
        # è·å–Gitæäº¤ID
        COMMIT_ID=$(git rev-parse --short HEAD)
        # è®¾ç½®ç‰ˆæœ¬ç¯å¢ƒå˜é‡
        echo "release_version=OpenWrt_${RELEASE_DATE}_${COMMIT_ID}" >> $GITHUB_ENV
        echo "release_version=OpenWrt_${RELEASE_DATE}_${COMMIT_ID}" >> $GITHUB_OUTPUT
        
        # ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯æ–‡ä»¶
        cat <<EOF > version.info
        OpenWrt å›ºä»¶ for JD BE6500 (IPQ5332)
        ç¼–è¯‘æ—¶é—´: $(date +"%Y-%m-%d %H:%M:%S")
        Git æäº¤: $COMMIT_ID
        åˆ†æ”¯: $LIENOL_BRANCH
        ç›®æ ‡å¹³å°: $ARCH/$SUBARCH
        å›ºä»¶åç§°: ${{ env.FIRMWARE_NAME }}
        å›ºä»¶å®Œæ•´è·¯å¾„: ${{ env.FIRMWARE_FULL_PATH }}
        å›ºä»¶å¤§å°: $(du -h ${{ env.FIRMWARE_FULL_PATH }} | cut -f1)
        å›ºä»¶SHA256æ ¡éªŒå’Œ: $(sha256sum ${{ env.FIRMWARE_FULL_PATH }} | cut -d' ' -f1)
        EOF

    - name: ä¸Šä¼ å›ºä»¶åˆ°Artifact
      # æ¡ä»¶ï¼šå½“UPLOAD_FIRMWAREä¸ºtrueæ—¶æ‰§è¡Œ
      if: env.UPLOAD_FIRMWARE == 'true'
      # ä½¿ç”¨ä¸Šä¼ Artifactçš„Action
      uses: actions/upload-artifact@v4
      with:
        # Artifactåç§°ï¼ˆä½¿ç”¨ç‰ˆæœ¬å·ï¼‰
        name: ${{ env.release_version }}
        # ä¸Šä¼ è·¯å¾„ï¼ˆå›ºä»¶åŠç›¸å…³æ–‡ä»¶ï¼‰
        path: |
          ${{ env.FIRMWARE_FULL_PATH }}
          ${{ env.FIRMWARE_PATH }}/*.img
          ${{ env.FIRMWARE_PATH }}/*.tar.gz
          ${{ env.FIRMWARE_PATH }}/sha256sums
          version.info
        # ä¿ç•™å¤©æ•°
        retention-days: 30
        # æœªæ‰¾åˆ°æ–‡ä»¶æ—¶å‡ºé”™
        if-no-files-found: error
      env:
        # ä¼ é€’å›ºä»¶è·¯å¾„ç¯å¢ƒå˜é‡
        FIRMWARE_PATH: ${{ env.FIRMWARE_PATH }}
        FIRMWARE_NAME: ${{ env.FIRMWARE_NAME }}
        FIRMWARE_FULL_PATH: ${{ env.FIRMWARE_FULL_PATH }}

    - name: å‘å¸ƒåˆ°GitHub Release
      # æ¡ä»¶ï¼šå½“UPLOAD_RELEASEä¸ºtrueä¸”è§¦å‘äº‹ä»¶ä¸ºreleaseæ—¶æ‰§è¡Œ
      if: env.UPLOAD_RELEASE == 'true' && github.event_name == 'release'
      # ä½¿ç”¨å‘å¸ƒReleaseçš„Action
      uses: softprops/action-gh-release@v1
      with:
        # Releaseåç§°ï¼ˆä½¿ç”¨ç‰ˆæœ¬å·ï¼‰
        name: ${{ env.release_version }}
        # æ ‡ç­¾åç§°ï¼ˆä½¿ç”¨ç‰ˆæœ¬å·ï¼‰
        tag_name: ${{ env.release_version }}
        # Releaseæ­£æ–‡è·¯å¾„ï¼ˆä½¿ç”¨ç‰ˆæœ¬ä¿¡æ¯æ–‡ä»¶ï¼‰
        body_path: version.info
        # é™„ä»¶æ–‡ä»¶ï¼ˆå›ºä»¶åŠç›¸å…³æ–‡ä»¶ï¼‰
        files: |
          ${{ env.FIRMWARE_FULL_PATH }}
          ${{ env.FIRMWARE_PATH }}/sha256sums
          version.info
        # æ˜¯å¦ä¸ºè‰ç¨¿
        draft: false
        # æ˜¯å¦ä¸ºé¢„å‘å¸ƒ
        prerelease: false
      env:
        # GitHubè®¤è¯ä»¤ç‰Œ
        GITHUB_TOKEN: ${{ secrets.MY_TOKEN }}
        # ä¼ é€’å›ºä»¶è·¯å¾„ç¯å¢ƒå˜é‡
        FIRMWARE_PATH: ${{ env.FIRMWARE_PATH }}
        FIRMWARE_NAME: ${{ env.FIRMWARE_NAME }}
        FIRMWARE_FULL_PATH: ${{ env.FIRMWARE_FULL_PATH }}
